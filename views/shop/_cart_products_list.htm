<?php $cartItems = $cart->getItems(); ?>

<?= Phpr_Form::openTag(["id" => "cart-form", "class" => "cart-products-list"]) ?>
<?php foreach ($cartItems as $item) : ?>

    <?php
    $product = $item->getProduct();
    $sku = $item->getSku();
    ?>

    <?php if ($product) : ?>
        <div class="product-cart">
            <?php if ($photo = $product->findMainPhoto()) : ?>
                <a class="product-cart_photo <?= $product->regular_photo ? 'photo--regular' : '' ?>" href="<?= $product->getUrl() ?>">
                    <?php
                    $width = $height = ($product->regular_photo) ? 150 : 150;
                    $img = $photo->getThumb($width, $height,  Phpr_ImageManipulator::keepRatio);
                    ?>

                    <img src="<?= $img ?>" alt="<?= $product->name ?>" />
                </a>
            <?php endif ?>

            <div class="product-cart_info">
                <a class="name" href="<?= $product->getUrl() ?>">
                    <?= $product->name ?>

                    <?php if ($sku) : ?>
                        <span><?= $sku->name ?></span>
                    <?php endif; ?>
                </a>

                <div class="other">
                    <div>Код товара: <?= $product->id ?><?= $sku ? "-" . $sku->id : null ?></div>
                    <div>В наличии: <?= $sku ? $sku->leftover : $product->leftover ?></div>
                </div>
            </div>

            <div class="product-cart_quantity">
                <?php
                $leftover = $sku ? $sku->leftover : $product->leftover;
                $productQuanty = $item->getQuantity();
                ?>

                <button class="btn-quantity-cart btn-quantity-minus"></button>
                <input type="number" min="0" max="<?= $leftover ?>" class="quantity-num" value="<?= $productQuanty ?>" name="quantity[<?= $item->getId() ?>]" />
                <button class="btn-quantity-cart btn-quantity-plus" data-disabled="<?= $leftover === $productQuanty ? true : false ?>"></button>
            </div>

            <div class="product-cart_price">
                <?php
                $product_price = cartProductPrice($item);
                $product_total_price = cartProductPrice($item, true);
                ?>

                <div><?= Core_Number::formatNumber($product_total_price) ?> &#8381;</div>
                <div><?= $item->getQuantity() ?></span> шт. &#215; <?= Core_Number::formatNumber($product_price) ?> &#8381;</div>
            </div>

            <a href="#" class="product-cart_del" data-handler="onDeleteItem" data-extra="<?= extra(["id" => $item->getId()]) ?>" title="Удалить"></a>
        </div>
    <?php else : ?>
        <? $cart->deleteItem($item) ?>
    <?php endif ?>
<?php endforeach ?>

<? Phpr_Form::closeTag() ?>