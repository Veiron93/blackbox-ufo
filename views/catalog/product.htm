<? Phpr_View::beginBlock("head") ?>
    <meta property="og:type" content="article" />
    <meta property="og:url" content="<?= Phpr::$request->getRootUrl() ?><?= Phpr::$request->getCurrentUri() ?>" />
    <meta property="og:site_name" content="<?= h(site_title()) ?>" />
	
	<? if (isset($product) && $product): ?>
		<?php $metaTitle = h(strip_tags($product->name)); ?>

		<meta name="description" content="Купить <?= $metaTitle ?> в интернет магазине BLACKBOX. Выгодные цены с бесплатной доставкой по городу г. Южно-Сахалинск">
		
		<meta property="og:title" content="<?= $metaTitle ?>" />
		<meta property="og:description" content="Купить <?= $metaTitle ?> в интернет магазине BLACKBOX. Выгодные цены с бесплатной доставкой по городу г. Южно-Сахалинск" />

		<meta name="twitter:card" content="summary" />
		<meta name="twitter:url" content="<?= Phpr::$request->getRootUrl() ?><?= Phpr::$request->getCurrentUri() ?>" />
		<meta name="twitter:title" content="<?= $metaTitle ?>" />
		<meta name="twitter:description" content="Купить <?= $metaTitle ?> в интернет магазине BLACKBOX. Выгодные цены с бесплатной доставкой по городу г. Южно-Сахалинск" />
		
		<? if ($product->photos->count): ?>
			<?php $imgMeta = $product->photos[0]->getThumb(480, 'auto'); ?>
			<meta property="og:image" content="<?= Phpr::$request->getRootUrl() ?><?= $imgMeta ?>">
			<meta name="twitter:image" content="<?= Phpr::$request->getRootUrl() ?><?= $imgMeta ?>">
		<? endif ?>
	<? endif ?>

<? Phpr_View::endBlock(true) ?>

<?php Phpr_View::beginBlock("view") ?>
	<div class="catalog-product container">

		<? $this->renderPartial('breadcrumbs', array('category' => $product->category, 'product' => $product)) ?>

		<?php if (isset($product) && $product): ?>
			<div class="catalog-product_name">
				<h1><?= $product->name ?></h1>
			</div>
			
			<div class="catalog-product_wrapper">

				<div class="catalog-product_details">
					<?php if ($product->photos->count > 1): ?>

						<div class="catalog-product-slider">

							<div class="button-prev"></div>
							<div class="button-next"></div>

							<div class="mySwiper2 swiper">
								<div class="swiper-wrapper" >
								  	<? foreach ($product->photos as $photo): ?>
								  		<div class="swiper-slide">
								  			<a href="<?= $photo->getThumb(1000, 800, Phpr_ImageManipulator::fit) ?>">
												<img src="<?= $photo->getThumb(370, 320, Phpr_ImageManipulator::keepRatio) ?>" alt="" />
											</a>
								  		</div>
									<? endforeach; ?>
								</div>
							</div>

							<div class="mySwiper swiper">
								<div class="swiper-wrapper">
								  	<? foreach ( $product->photos as $photo ): ?>
								  		<div class="swiper-slide">
								  			<img src="<?= $photo->getThumb(66, 66, Phpr_ImageManipulator::keepRatio) ?>" alt="" />
								  		</div>
									<? endforeach; ?>
								</div>
							</div>
						</div>

					<?php else: ?>
						<?
							$mainPhoto = $product->findMainPhoto();
							$img = $mainPhoto ? $mainPhoto->getThumb(450, 'auto'): '/resources/images/no-image.png';
						?>

						<div class="catalog-product_photo" class="pswp">
							<a href="<?= $img ?>">
								<img src="<?= $img ?>" alt="">
							</a>
						</div>
					<?php endif; ?>
					
					<div class="description" data-formatted-text>
						<?= $product->description ?>
					</div>
				</div>

				<div class="catalog-product_buy">
					<? if ($product->price): ?>
						<div class="catalog-product_buy-price <?=$product->old_price ? 'sale':''?>">
							<?php if($product->old_price): ?>
								<div class="old"><?= Phpr::$lang->num($product->old_price) ?></div>
							<?php endif; ?>
							
							<div class="actual"><?= Phpr::$lang->num($product->price) ?></div>
						</div>
					<? endif ?>

					<!-- <div class="catalog-product_buy-promo">
						<div class="promo-title">Товар участвует в акциях</div>

						<div class="promo-list">
							<a href="">Новогодняя распродажа</a>
							<a href="">Подарок за покупку</a>
						</div>
					</div> -->

					<?= Phpr_Form::openTag(array("action" => u("shop_cart", []), "id" => "form-{$product->id}")) ?>
						<?php 
							$viewData = [
								'withQuantity' => true,
								'initialQuantity' => 1,
								'item' => $product,
								'type' => 'product',
								'idPrefix' => "atc-product-{$product->id}"
							];
						?>

						<?php $this->renderPartial($this->getViewsDir() . "/shop/_add_to_cart.htm", $viewData);?>
					<? Phpr_Form::closeTag(); ?>

					<div class="product-other-info">
						<div>Код товара: <?= $product->id ?></div>
						<div>В наличии: <?= $product->leftover ?></div>

						<?php if($product->sales): ?>
							<div>Купили: <?= $product->sales ?></div>
						<?php endif;?>
					</div>

					<?php 
						$urlWhatsApp = Phpr::$config->get('TEXT_WHATSAPP_QUESTION_PRODUCT');
						$urlWhatsApp .= $url = 'https://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];
					?>

					<div class="btn-question">
						<a href="<?=$urlWhatsApp?>" target="_blank">
							<img src="/resources/images/icons/social/whatsapp.svg" alt="whatsapp">
							<span>Задать вопрос по данному товару</span>
						</a>
					</div>
				</div>
			</div>
		<? else: ?>
			<h2>Продукт не найден</h2>
		<? endif; ?>
	</div>
<? Phpr_View::endBlock() ?>