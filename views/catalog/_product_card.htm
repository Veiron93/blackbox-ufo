<div class="product-card">
	<div class="product-card_photo <?= $product->regular_photo ? 'product-card_photo--regular': 'product-card_photo--normal'?>">
		<a href="/catalog/product/<?= $product->id ?>">
			<?php
				$image_id = null;
				$image_path = null;

				if($product->image_id && $product->image_path){
					$image_id = $product->image_id;
					$image_path = $product->image_path;

				}elseif(isset($product->photos) && count($product->photos)){
					$image_id = $product->photos[0]->id;
					$image_path = $product->photos[0]->disk_name;
				}

				if($image_id && $image_path){
					$image = (new LWImageManipulator($image_id, $image_path))->getThumb(240, 240, Phpr_ImageManipulator::keepRatio);
				}else if($product->findMainPhoto()){
					$image = $product->findMainPhoto()->getThumb(240, 240, Phpr_ImageManipulator::keepRatio);
				}else{
					$image = '/resources/images/icons/no-image.svg';
				}
			?>
			
			<img src="<?= $image ?>" alt="<?= $product->name?>" />
		</a>

		<?php if($product->old_price):?>
			<div class="product-card_flags">
				<?php if($product->old_price): ?>
					<div class="discount-percentage">
						- <?= App_Helper::getDiscountPercentage($product->old_price, $product->price);?>%
					</div>
				<?php endif; ?>
			</div>
		<?php endif; ?>
	</div>

	<div class="product-card_info">
		<div class="product-card_info-name">
			<a href="/catalog/product/<?= $product->id ?>" title="<?= $product->name ?>"><?= $product->name ?></a>
		</div>

		<div class="product-card_info-buy">

			<?php if($product->price): ?>
				<div class="price">
					<?php if($product->old_price): ?>
						<div class="price-old"><?= Phpr::$lang->num($product->old_price) ?></div>
					<?php endif ?>

					<?php if($product->price): ?>
						<div class="price-actual"><?= Phpr::$lang->num($product->price) ?></div>
					<?php endif ?>
				</div>

				<?= Phpr_Form::openTag(array("action" => u("shop_cart", []), "id" => "form-{$product->id}")) ?>
					
					<?php 
						$viewData = [
							'withQuantity' => true,
							'initialQuantity' => 1,
							'item' => $product,
							'type' => 'product',
							'idPrefix' => "atc-product-{$product->id}",
							'idsProductsCart' => $idsProductsCart
						];
					?>

					<?php $this->renderPartial($this->getViewsDir() . "/shop/_add_to_cart.htm", $viewData);?>
				<? Phpr_Form::closeTag(); ?>
			<?php endif; ?>
		</div>
	</div>
</div>